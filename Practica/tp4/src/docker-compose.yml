version: '2'
services:

  node-red:
    build: ./img-node-red/
    volumes:
      - ./img-node-red/storage/:/home/src/node_modules/node-red/red/runtime/storage/
      - ./img-node-red/mis-nodos/:/home/mis-nodos/
    #ports: # huesped:anfitrion
    #  - "9229:9229"
    depends_on:
      - storage-api
      - mqtt

  # api para almacenar flows en mongo
  storage-api:
    build: ./img-storage-api/
    depends_on:
      - mongo

  # proxy inverso
  nginx:
    build: ./img-proxy/
    volumes:
      - ./img-proxy/nginx/:/etc/nginx/
      - ./img-proxy/hivemq-mqtt-web-client/:/etc/hivemq-mqtt-web-client/mqtt/test
    ports: # huesped:anfitrion
      - "80:80"
      #- "9229:9229"
    links:
      - node-red
      - mqtt
      - mqtt-web

  mqtt-web:
    build: ./img-mqtt-web
    depends_on:
      - mqtt

  # broker de mensajes mqtt
  mqtt:
    build: ./img-mosquitto/
    volumes:
      - ./img-mosquitto/mosquitto/:/mosquitto

  mongo:
    image: "mongo"
